<% const tagMap={}; tools.forEach(tool=> {
  if (tool.status === 'active' && tool.tags && Array.isArray(tool.tags)) {
  tool.tags.forEach(tag => {
  const normalized = tag.toLowerCase().trim();
  if (normalized) {
  tagMap[normalized] = (tagMap[normalized] || 0) + 1;
  }
  });
  }
  });

  const sortedTags = Object.keys(tagMap).sort((a, b) => tagMap[b] - tagMap[a]);
  const displayTags = sortedTags.slice(0, 25);
  %>

  <% if (displayTags.length> 0) { %>
    <section class="tag-cloud-section container">
      <div class="section-header">
        <h2 class="section-title">
          <i data-lucide="tags"></i>
          <%= t('home.tag_cloud_title') || 'Từ khóa phổ biến' %>
        </h2>
        <p class="section-desc">Tìm kiếm bộ công cụ theo nhu cầu của bạn</p>
      </div>

      <div class="tag-cloud">
        <% displayTags.forEach(tag=> {
          const count = tagMap[tag];
          const sizeClass = count > 3 ? 'tag-lg' : (count > 1 ? 'tag-md' : 'tag-sm');
          %>
          <a href="<%= rootPath %><%= locale %>/categories/" class="cloud-tag <%= sizeClass %>">
            #<%= tag %>
          </a>
          <% }); %>
      </div>
    </section>

    <style>
      .tag-cloud-section {
        padding: 4rem 0;
        margin-top: 3rem;
        border-top: 1px solid var(--border-color);
      }

      .section-header {
        margin-bottom: 2rem;
        text-align: center;
      }

      .section-title {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        font-size: 1.75rem;
        font-weight: 800;
        margin-bottom: 0.5rem;
      }

      .section-desc {
        color: var(--text-muted);
        font-size: 1rem;
      }

      .tag-cloud {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 12px;
        max-width: 900px;
        margin: 0 auto;
      }

      .cloud-tag {
        text-decoration: none;
        padding: 6px 16px;
        border-radius: 50px;
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        color: var(--text-color);
        font-weight: 500;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        display: inline-block;
      }

      .cloud-tag:hover {
        border-color: var(--primary-color);
        color: var(--primary-color);
        transform: translateY(-2px) scale(1.05);
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
      }

      .tag-sm {
        font-size: 0.85rem;
        opacity: 0.7;
      }

      .tag-md {
        font-size: 1rem;
        font-weight: 600;
        opacity: 0.85;
      }

      .tag-lg {
        font-size: 1.15rem;
        font-weight: 700;
        background: linear-gradient(135deg, var(--card-bg), var(--bg-hover));
        border-color: var(--primary-color);
        color: var(--primary-color);
      }

      [data-theme="dark"] .cloud-tag {
        background: rgba(255, 255, 255, 0.05);
      }

      [data-theme="dark"] .tag-lg {
        background: rgba(59, 130, 246, 0.1);
      }
    </style>
    <% } %>